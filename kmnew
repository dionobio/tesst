<?php require_once 'views/layout/header.php'; ?>
<?php require_once 'views/layout/menu.php'; ?>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="position-sticky">
                <form class="p-3" id="searchForm" aria-label="T√¨m ki·∫øm khuy·∫øn m√£i">
                    <h5 class="text-primary">T√¨m Ki·∫øm Khuy·∫øn M√£i</h5>
                    <div class="mb-3">
                        <label for="searchName" class="form-label">T√¨m Theo T√™n Khuy·∫øn M√£i</label>
                        <input type="text" class="form-control" id="searchName" placeholder="Nh·∫≠p t√™n khuy·∫øn m√£i"
                            oninput="searchTable()">
                    </div>
                    <div class="mb-3">
                        <label for="searchCode" class="form-label">T√¨m Theo M√£ Khuy·∫øn M√£i</label>
                        <input type="text" class="form-control" id="searchCode" placeholder="Nh·∫≠p m√£ khuy·∫øn m√£i"
                            oninput="searchTable()">
                    </div>
                </form>

            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <section class="khuyen-mai-section py-5">
                <div class="container">
                    <h1 class="text-center mb-5 section-title">üéÅ Danh S√°ch Khuy·∫øn M√£i üéÑ</h1>
                    <div class="row g-4">
                        <?php if (!empty($khuyenMaiList)): ?>
                        <?php foreach ($khuyenMaiList as $khuyenMai): ?>
                        <div class="col-md-6 col-lg-4 col-12">
                            <div class="promotion-banner christmas-theme" aria-label="Th√¥ng tin khuy·∫øn m√£i">
                                <h2 c lass="text-truncate"><?= htmlspecialchars($khuyenMai['ten_khuyen_mai']); ?></h2>
                                <p class="text-truncate"><?= htmlspecialchars($khuyenMai['mo_ta']); ?></p>
                                <p class="discount" style="font-size:30px;">üéÑ U∆∞ ƒë√£i l√™n ƒë·∫øn
                                <p style="font-size:50px;">üéÅ<?= htmlspecialchars($khuyenMai['discount_value']); ?>%</p>
                                </p>
                                <p>Th·ªùi gian: T·ª´ <?= htmlspecialchars($khuyenMai['ngay_bat_dau']); ?> ƒë·∫øn
                                    <?= htmlspecialchars($khuyenMai['ngay_ket_thuc']); ?></p>
                                <p>M√£:
                                    <span id="code-<?= $khuyenMai['id']; ?>" class="badge text-white code-badge">
                                        <?= htmlspecialchars($khuyenMai['ma_khuyen_mai']); ?>
                                    </span>
                                    <button class="btn btn-outline-light btn-sm mt-2"
                                        onclick="copyToClipboard('code-<?= $khuyenMai['id']; ?>')">
                                        Sao ch√©p m√£
                                    </button>
                                </p>
                                <span
                                    class="badge 
                                    <?= $khuyenMai['trang_thai'] == 'active' ? 'bg-success' : 
                                    ($khuyenMai['trang_thai'] == 'suspended' ? 'bg-warning text-dark' : 'bg-danger'); ?>">
                                    <?= $khuyenMai['trang_thai'] == 'active' ? 'ƒêang ho·∫°t ƒë·ªông' : 
                                    ($khuyenMai['trang_thai'] == 'suspended' ? 'T·∫°m d·ª´ng' : 'ƒê√£ h·∫øt h·∫°n'); ?>
                                </span>
                            </div>

                        </div>
                        <?php endforeach; ?>
                        <?php else: ?>
                        <div class="col-12 text-center text-muted">
                            Kh√¥ng c√≥ khuy·∫øn m√£i n√†o.
                        </div>
                        <?php endif; ?>
                    </div>  
                    <br>
                    <div id="noResult" class="text-center text-muted" style="display: none;">
                        Kh√¥ng c√≥ khuy·∫øn m√£i n√†o ph√π h·ª£p.
                    </div>

                </div>
                <br> <br>
                <br> <br>
                <br> <br>
                <br>
            </section>
        </main>
    </div>
</div>

<?php require_once 'views/layout/footer.php'; ?>

<script>
function copyToClipboard(elementId) {
    const text = document.getElementById(elementId).innerText;
    navigator.clipboard.writeText(text).then(() => {
        alert('ƒê√£ sao ch√©p: ' + text);
    }).catch(err => {
        console.error('L·ªói khi sao ch√©p: ', err);
    });
}

function searchTable() {
    let inputName = document.getElementById('searchName').value.trim().toLowerCase();
    let inputCode = document.getElementById('searchCode').value.trim().toLowerCase();
    let promotions = document.querySelectorAll('.promotion-banner');
    let hasResult = false;

    promotions.forEach(promotion => {
        let name = promotion.querySelector('h2').innerText.toLowerCase();
        let code = promotion.querySelector('.code-badge').innerText.toLowerCase();

        if ((name.includes(inputName) || inputName === '') &&
            (code.includes(inputCode) || inputCode === '')) {
            promotion.parentElement.style.display = 'block';
            hasResult = true;
        } else {
            promotion.parentElement.style.display = 'none';
        }
    });

    // Hi·ªÉn th·ªã ho·∫∑c ·∫©n th√¥ng b√°o "kh√¥ng c√≥ k·∫øt qu·∫£"
    document.getElementById('noResult').style.display = hasResult ? 'none' : 'block';
}



function generateSnowflakesInBanner() {
    const banners = document.querySelectorAll('.promotion-banner'); // L·∫•y t·∫•t c·∫£ c√°c banner
    banners.forEach(banner => {
        const snowflakesCount = 10; // S·ªë l∆∞·ª£ng b√¥ng tuy·∫øt trong m·ªói banner
        for (let i = 0; i < snowflakesCount; i++) {
            let snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.textContent = '‚ùÑ'; // B√¥ng tuy·∫øt
            snowflake.style.left = Math.random() * 200 + 'vw'; // V·ªã tr√≠ ng·∫´u nhi√™n theo chi·ªÅu ngang
            snowflake.style.animationDuration = Math.random() * 5 + 5 + 's'; // Th·ªùi gian r∆°i ng·∫´u nhi√™n
            snowflake.style.animationDelay = Math.random() * 10 + 's'; // Tr·ªÖ ng·∫´u nhi√™n

            // ƒê·∫£m b·∫£o r·∫±ng b√¥ng tuy·∫øt r∆°i trong ph·∫°m vi c·ªßa banner
            banner.appendChild(snowflake);

            // Xo√° b√¥ng tuy·∫øt khi k·∫øt th√∫c animation
            snowflake.addEventListener('animationend', () => {
                snowflake.remove();
            });
        }
    });
}

// G·ªçi h√†m ƒë·ªÉ t·∫°o b√¥ng tuy·∫øt khi trang ƒë∆∞·ª£c t·∫£i
window.onload = generateSnowflakesInBanner;


// G·ªçi h√†m ƒë·ªÉ t·∫°o b√¥ng tuy·∫øt khi trang ƒë∆∞·ª£c t·∫£i
window.onload = generateSnowflakes;
</script>

<style>
.promotion-banner {
    width: 100%;
    min-height: 250px;
    background: linear-gradient(135deg, #ff5f5f, #ffd1d1);
    color: white;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    padding: 15px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    /* ƒê·∫£m b·∫£o b√¥ng tuy·∫øt n·∫±m trong banner */
}

.promotion-banner:hover {
    transform: translateY(-10px);
    /* N√¢ng l√™n khi hover */
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
    /* Th√™m b√≥ng khi hover */
}

.promotion-banner h2,
.promotion-banner p {
    margin-bottom: 10px;
}

.promotion-banner .discount {
    font-size: 1rem;
    font-weight: bold;
    color: #ffdfba;
}

.promotion-banner button {
    margin-top: 10px;
}

.promotion-banner .badge {
    margin-top: 10px;
}

.snowflake {
    position: absolute;
    color: white;
    font-size: 1.5rem;
    pointer-events: none;
    user-select: none;
    z-index: 9999;
    animation: fall 10s linear infinite;
}

@keyframes fall {
    0% {
        top: -10px;
        opacity: 1;
    }

    100% {
        top: 100%;
        opacity: 0;
    }
}

.promotion-banner h2 {
    font-size: 1.5rem;
    font-weight: bold;
    text-transform: uppercase;
    /* Vi·∫øt hoa t·∫•t c·∫£ c√°c ch·ªØ c√°i */
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    /* ƒê·ªï b√≥ng cho ti√™u ƒë·ªÅ */
    color: #ffffff;
    /* ƒê·∫£m b·∫£o ch·ªØ m√†u tr·∫Øng */
    transition: all 0.3s ease-in-out;
    /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi khi hover */
}

.promotion-banner p {
    font-size: 1rem;
    color: #ffdfba;
    /* M√†u ch·ªØ m√¥ t·∫£ */
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    /* ƒê·ªï b√≥ng cho m√¥ t·∫£ */
}

.promotion-banner .discount {
    font-size: 1.1rem;
    font-weight: bold;
    color: #ffdfba;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    /* ƒê·ªï b√≥ng cho discount */
}

.promotion-banner .badge {
    font-size: 0.9rem;
    font-weight: bold;
    text-transform: uppercase;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    /* ƒê·ªï b√≥ng cho badge */
}

.promotion-banner:hover h2 {
    color: #ff5f5f;
    /* Thay ƒë·ªïi m√†u ti√™u ƒë·ªÅ khi hover */
    text-shadow: 2px 2px 8px rgba(255, 87, 34, 0.8);
    /* TƒÉng ƒë·ªô ƒë·ªï b√≥ng khi hover */
}

.promotion-banner:hover p {
    color: #fff7e6;
    /* M√†u ch·ªØ m√¥ t·∫£ thay ƒë·ªïi khi hover */
}

.promotion-banner:hover .discount {
    color: #ffdfba;
    text-shadow: 1px 1px 5px rgba(255, 87, 34, 0.8);
    /* TƒÉng ƒë·ªô ƒë·ªï b√≥ng khi hover */
}

.promotion-banner:hover .badge {
    background-color: #ff5f5f;
    /* M√†u n·ªÅn badge thay ƒë·ªïi khi hover */
    color: #fff;
    /* ƒê·ªïi m√†u ch·ªØ badge */
    text-shadow: 2px 2px 5px rgba(255, 87, 34, 0.8);
    /* TƒÉng ƒë·ªô ƒë·ªï b√≥ng khi hover */
}
</style>
